<div class="video-page" *ngIf="video">

  

  <div class="video-wrapper">

    <div *ngIf="playerMode === 'LOADING'">
      Učitavanje...
    </div>

    <div *ngIf="playerMode === 'BLOCKED'">
      Ovaj video još nije dostupan.
    </div>

    <div *ngIf="playerMode === 'ERROR'">
      Greška pri učitavanju videa.
    </div>

    <video
      #player
      *ngIf="playerMode === 'HLS' || playerMode === 'MP4'"
      controls
      autoplay
      playsinline>
    </video>

  </div>

  <!-- Čet tokom streaminga (samo za HLS / zakazani prikaz) -->
  <div class="streaming-chat-panel" *ngIf="playerMode === 'HLS'">
    <h3 class="streaming-chat-title">Čet tokom gledanja</h3>
    <div class="streaming-chat-messages">
      <div class="streaming-chat-msg" *ngFor="let m of streamChatMessages">
        <span class="streaming-chat-author">{{ m.authorName }}:</span>
        <span class="streaming-chat-text">{{ m.text }}</span>
        <span class="streaming-chat-time">{{ m.timestamp | date:'shortTime' }}</span>
      </div>
    </div>
    <div class="streaming-chat-form">
      <input
        type="text"
        [(ngModel)]="newStreamChatMessage"
        placeholder="Poruka..."
        (keydown.enter)="sendStreamChat()"
        [disabled]="!authService.tokenIsPresent()">
      <button type="button" (click)="sendStreamChat()" [disabled]="!authService.tokenIsPresent()">
        Pošalji
      </button>
    </div>
    <p class="streaming-chat-hint" *ngIf="!authService.tokenIsPresent()">
      Ulogujte se da biste slali poruke u čet.
    </p>
  </div>

  <h2 class="video-title-main">{{ video.title }}</h2>

  <div class="video-meta">
    <div *ngIf="video.ownerId" class="meta-row">
      <strong>Posted by:</strong>
      <a class="meta-link" [routerLink]="['/profile', video.ownerId]">
        {{ video.ownerFullName || ('User #' + video.ownerId) }}
      </a>
    </div>
    
    <div *ngIf="video.description" class="meta-row">
      <strong>Description:</strong> {{ video.description }}
    </div>

    <div *ngIf="video.tags?.length" class="meta-row">
      <strong>Tags:</strong> {{ video.tags.join(', ') }}
    </div>

    <div *ngIf="video.createdAt" class="meta-row">
      <strong>Created:</strong> {{ video.createdAt | date:'medium' }}
    </div>
    <div *ngIf="video.views !== undefined" class="meta-row">
  <strong>Views:</strong> {{ video.views }}
</div>

    <div *ngIf="video.location" class="meta-row">
      <strong>Location:</strong> {{ video.location }}
    </div>
  </div>

  <div class="actions" *ngIf="video">
    <button
      (click)="toggleLike()"
      [class.active]="video.likedByMe">
      Like {{ video.likesCount }}
    </button>
  </div>

  <hr>

  <h3 class="comments-title">Comments</h3>

  <div class="comment-form">
    <textarea
      [(ngModel)]="newComment"
      placeholder="Write a comment..."
      rows="3">
    </textarea>

    <button (click)="addComment()">
      Add comment
    </button>
  </div>

  <div class="comment-error" *ngIf="commentError">{{ commentError }}</div>
  <div *ngIf="loadingComments">Loading comments...</div>

  <div class="comments">
    <div class="comment" *ngFor="let c of comments">
      <a class="comment-author" [routerLink]="['/profile', c.authorId]">
        {{ c.authorName || c.authorEmail }}
      </a>
      <div class="comment-text">{{ c.text }}</div>
      <div class="comment-date">
        {{ c.createdAt | date:'short' }}
      </div>
    </div>
  </div>

  <div class="pagination" *ngIf="totalPages > 1">
    <button class="page-btn" (click)="prevPage()" [disabled]="page === 0">
      ‹
    </button>

    <span class="page-info">
      {{ page + 1 }} / {{ totalPages }}
    </span>

    <button class="page-btn" (click)="nextPage()" [disabled]="page + 1 >= totalPages">
      ›
    </button>
  </div>
  
</div>
